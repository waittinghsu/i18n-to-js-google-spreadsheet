#!/usr/bin/env node
const configPath = process.argv[2];
const loadPath = !!configPath ? configPath.split('=')[1] : process.cwd();

const path = require('path');
const fs = require('fs');

// æª¢æŸ¥é…ç½®æª”æ˜¯å¦å­˜åœ¨
const configFilePath = path.resolve(loadPath, 'i18n-to-js.config.js');
if (!fs.existsSync(configFilePath)) {
  console.log('ğŸ“„ æ‰¾ä¸åˆ°é…ç½®æª”ï¼ši18n-to-js.config.js');
  console.log('ğŸ”§ è‡ªå‹•å»ºç«‹åŸºæœ¬é…ç½®æª”...');

  // ç›´æ¥è¤‡è£½ config.js æª”æ¡ˆä½œç‚ºé…ç½®æª”
  const defaultConfigPath = path.resolve(__dirname, '../src/lib/config.js');

  try {
    fs.copyFileSync(defaultConfigPath, configFilePath);
    console.log('âœ… å·²è‡ªå‹•å»ºç«‹é…ç½®æª”ï¼ši18n-to-js.config.js');
    console.log('âš ï¸  è«‹ç·¨è¼¯é…ç½®æª”ä¸¦å¡«å…¥æ­£ç¢ºçš„ API Key å’Œæª”æ¡ˆè·¯å¾‘');
  } catch (error) {
    console.error('âŒ å»ºç«‹é…ç½®æª”å¤±æ•—:', error.message);
    console.error('ğŸ“ è«‹æ‰‹å‹•è¤‡è£½ i18n-to-js.config.example.js ç‚º i18n-to-js.config.js');
    process.exit(1);
  }
}

const option = require(configFilePath);
const { coreForGoogle, coreForLocal } = require('../src/lib/index');

console.log('ğŸ¢ ğŸ¢ google excel æ“·å–ä¸­ ğŸ¢ğŸ¢ğŸ¢ ğŸ§—...');
const { mode = 'LOCAL' } = option;

switch (mode) {
  case 'LOCAL':
	  console.log('ğŸ¦€ LOCAL ğŸ¦€');
    coreForLocal(option);
    break;
  case 'GOOGLE_SHEET':
	  console.log('ğŸ¦€ GOOGLE_SHEET ğŸ¦€');
    coreForGoogle(option).then(() => {
      console.log('ğŸ‰ ç”Ÿæˆå®Œæˆ ğŸ‰');
    }).catch((err) => {
      console.error(`ğŸ‘¹ åª½é€¼ç‚¸äº†â€${err}`);
    });
    break;
  default:
    break;
}
